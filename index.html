<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6366f1">
    <title>Mostafa Recorder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .animate-pulse { 
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; 
        }
        @keyframes pulse { 
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 text-white min-h-screen">
    <div class="max-w-4xl mx-auto p-4">
        <div class="text-center mb-8 pt-6">
            <h1 class="text-4xl font-bold mb-2">Mostafa Recorder</h1>
            <p class="text-blue-200">Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø´Ø§Ø´Ø© Ø§Ø­ØªØ±Ø§ÙÙŠ ÙˆØ®ÙÙŠÙ</p>
        </div>
        
        <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-6 mb-6 shadow-2xl">
            <div class="text-center mb-6">
                <div id="timer" class="text-6xl font-mono mb-2 text-purple-200">00:00:00</div>
                <div id="status" class="h-6"></div>
            </div>
            
            <div class="flex justify-center gap-3 mb-6 flex-wrap">
                <button id="startBtn" class="bg-red-500 hover:bg-red-600 px-6 py-3 rounded-full font-bold">Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
                <button id="pauseBtn" class="hidden bg-yellow-500 hover:bg-yellow-600 px-6 py-3 rounded-full font-bold">Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª</button>
                <button id="resumeBtn" class="hidden bg-green-500 hover:bg-green-600 px-6 py-3 rounded-full font-bold">Ø§Ø³ØªØ¦Ù†Ø§Ù</button>
                <button id="stopBtn" class="hidden bg-red-600 hover:bg-red-700 px-6 py-3 rounded-full font-bold">Ø¥ÙŠÙ‚Ø§Ù</button>
            </div>
            
            <div class="text-center">
                <button id="settingsBtn" class="bg-white/20 hover:bg-white/30 px-6 py-2 rounded-full">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
            </div>
            
            <div id="settings" class="hidden mt-6 p-6 bg-white/10 rounded-2xl space-y-4">
                <div>
                    <label class="block mb-2">Ø§Ù„Ø¬ÙˆØ¯Ø©:</label>
                    <select id="quality" class="w-full bg-white/20 rounded-lg p-3 text-white">
                        <option value="SD">SD (480p)</option>
                        <option value="HD" selected>HD (720p)</option>
                        <option value="FHD">Full HD (1080p)</option>
                    </select>
                </div>
                <div>
                    <label class="block mb-2">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª:</label>
                    <select id="fps" class="w-full bg-white/20 rounded-lg p-3 text-white">
                        <option value="24">24 FPS</option>
                        <option value="30" selected>30 FPS</option>
                        <option value="60">60 FPS</option>
                    </select>
                </div>
                <div class="flex items-center justify-between">
                    <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª:</span>
                    <button id="micBtn" class="p-3 rounded-full bg-green-500">ğŸ¤</button>
                </div>
            </div>
        </div>
        
        <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-6 shadow-2xl">
            <h2 class="text-2xl font-bold mb-4">Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª (<span id="count">0</span>)</h2>
            <div id="recordings" class="space-y-4">
                <div class="text-center py-12 text-blue-200">
                    <p class="text-lg">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø¨Ø¹Ø¯</p>
                    <p class="text-sm mt-2">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¢Ù†!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        var mediaRecorder, chunks = [], stream, time = 0, timer, recs = [];
        var mic = true, qual = 'HD', rate = 30;

        document.getElementById('settingsBtn').onclick = function() {
            var el = document.getElementById('settings');
            el.classList.toggle('hidden');
        };

        document.getElementById('quality').onchange = function(e) {
            qual = e.target.value;
        };

        document.getElementById('fps').onchange = function(e) {
            rate = parseInt(e.target.value);
        };

        document.getElementById('micBtn').onclick = function() {
            mic = !mic;
            this.className = 'p-3 rounded-full ' + (mic ? 'bg-green-500' : 'bg-red-500');
            this.textContent = mic ? 'ğŸ¤' : 'ğŸ”‡';
        };

        function fmt(s) {
            var h = Math.floor(s / 3600);
            var m = Math.floor((s % 3600) / 60);
            var sec = s % 60;
            return pad(h) + ':' + pad(m) + ':' + pad(sec);
        }

        function pad(n) {
            return n < 10 ? '0' + n : n;
        }

        function tick() {
            time++;
            document.getElementById('timer').textContent = fmt(time);
        }

        async function start() {
            try {
                var w = qual === 'FHD' ? 1920 : qual === 'HD' ? 1280 : 854;
                var h = qual === 'FHD' ? 1080 : qual === 'HD' ? 720 : 480;
                
                var vid = await navigator.mediaDevices.getDisplayMedia({
                    video: {width: w, height: h, frameRate: rate}
                });
                
                var aud = null;
                if (mic) {
                    try {
                        aud = await navigator.mediaDevices.getUserMedia({audio: true});
                    } catch (e) {}
                }
                
                var tracks = vid.getVideoTracks();
                if (aud) {
                    tracks = tracks.concat(aud.getAudioTracks());
                }
                
                stream = new MediaStream(tracks);
                var bits = qual === 'FHD' ? 8000000 : qual === 'HD' ? 5000000 : 2500000;
                mediaRecorder = new MediaRecorder(stream, {
                    mimeType: 'video/webm;codecs=vp9',
                    videoBitsPerSecond: bits
                });
                
                chunks = [];
                
                mediaRecorder.ondataavailable = function(e) {
                    if (e.data.size > 0) chunks.push(e.data);
                };
                
                mediaRecorder.onstop = function() {
                    var blob = new Blob(chunks, {type: 'video/webm'});
                    var url = URL.createObjectURL(blob);
                    var rec = {
                        id: Date.now(),
                        url: url,
                        dur: time,
                        date: new Date().toLocaleString('ar-EG'),
                        size: (blob.size / (1024 * 1024)).toFixed(2)
                    };
                    recs.unshift(rec);
                    updateList();
                    time = 0;
                    document.getElementById('timer').textContent = '00:00:00';
                    stream.getTracks().forEach(function(t) { t.stop(); });
                };
                
                mediaRecorder.start(1000);
                document.getElementById('startBtn').classList.add('hidden');
                document.getElementById('pauseBtn').classList.remove('hidden');
                document.getElementById('stopBtn').classList.remove('hidden');
                timer = setInterval(tick, 1000);
                document.getElementById('status').innerHTML = '<div class="flex items-center justify-center gap-2"><div class="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div><span class="text-red-300 font-semibold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</span></div>';
                
                vid.getVideoTracks()[0].onended = function() {
                    stop();
                };
            } catch (e) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£. ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ù†Ø­ Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø©.');
            }
        }

        function pause() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.pause();
                clearInterval(timer);
                document.getElementById('pauseBtn').classList.add('hidden');
                document.getElementById('resumeBtn').classList.remove('hidden');
                document.getElementById('status').innerHTML = '<span class="text-yellow-300 font-semibold">Ù…ØªÙˆÙ‚Ù Ù…Ø¤Ù‚ØªØ§Ù‹</span>';
            }
        }

        function resume() {
            if (mediaRecorder && mediaRecorder.state === 'paused') {
                mediaRecorder.resume();
                timer = setInterval(tick, 1000);
                document.getElementById('resumeBtn').classList.add('hidden');
                document.getElementById('pauseBtn').classList.remove('hidden');
                document.getElementById('status').innerHTML = '<div class="flex items-center justify-center gap-2"><div class="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div><span class="text-red-300 font-semibold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</span></div>';
            }
        }

        function stop() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                clearInterval(timer);
                document.getElementById('startBtn').classList.remove('hidden');
                document.getElementById('pauseBtn').classList.add('hidden');
                document.getElementById('resumeBtn').classList.add('hidden');
                document.getElementById('stopBtn').classList.add('hidden');
                document.getElementById('status').innerHTML = '';
            }
        }

        function updateList() {
            document.getElementById('count').textContent = recs.length;
            if (recs.length === 0) {
                document.getElementById('recordings').innerHTML = '<div class="text-center py-12 text-blue-200"><p class="text-lg">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø¨Ø¹Ø¯</p></div>';
                return;
            }
            var html = '';
            for (var i = 0; i < recs.length; i++) {
                var r = recs[i];
                html += '<div class="bg-white/10 rounded-xl p-4 flex items-center justify-between"><div class="flex-1"><div class="font-bold mb-1">ØªØ³Ø¬ÙŠÙ„ ' + r.id + '</div><div class="text-sm text-blue-200"><span>â±ï¸ ' + fmt(r.dur) + '</span><span class="mr-4">ğŸ“ ' + r.size + ' MB</span><span class="mr-4">ğŸ“… ' + r.date + '</span></div></div><div class="flex gap-2"><button onclick="dl(' + r.id + ')" class="bg-green-500 hover:bg-green-600 p-3 rounded-full">ğŸ’¾</button><button onclick="del(' + r.id + ')" class="bg-red-500 hover:bg-red-600 p-3 rounded-full">ğŸ—‘ï¸</button></div></div>';
            }
            document.getElementById('recordings').innerHTML = html;
        }

        function dl(id) {
            for (var i = 0; i < recs.length; i++) {
                if (recs[i].id === id) {
                    var a = document.createElement('a');
                    a.href = recs[i].url;
                    a.download = 'Mostafa_Recorder_' + id + '.webm';
                    a.click();
                    break;
                }
            }
        }

        function del(id) {
            var newRecs = [];
            for (var i = 0; i < recs.length; i++) {
                if (recs[i].id !== id) {
                    newRecs.push(recs[i]);
                }
            }
            recs = newRecs;
            updateList();
        }

        document.getElementById('startBtn').onclick = start;
        document.getElementById('pauseBtn').onclick = pause;
        document.getElementById('resumeBtn').onclick = resume;
        document.getElementById('stopBtn').onclick = stop;
    </script>
</body>
</html>